# 🎮 발전기 게임 시스템 (Generator Game System)

이 프로젝트는 **ESP32**를 기반으로 한 방탈출 게임용 발전기 장치입니다.  
사용자가 열심히 핸들을 돌려(엔코더 회전) 전력을 공급하고, RFID 카드를 태그하여 발전기를 가동시키는 시뮬레이션 게임입니다.

---

## 🛠 하드웨어 구성 (Hardware)

이 코드는 다음 하드웨어 장치들과 연결되어 동작합니다.

1.  **메인 컨트롤러**: ESP32 개발 보드 (NodeMCU-32S 등)
2.  **RFID 리더**: PN532 (NFC/RFID 모듈, SPI 통신)
3.  **디스플레이**: Nextion HMI LCD (시리얼 통신)
4.  **LED**: Neopixel (WS2812B) 스트립 (게이지, 상태 표시용)
5.  **입력 장치**: 로터리 엔코더 (발전기 핸들 회전 감지)
6.  **출력 장치**: DC 모터 (진동/회전 피드백)

---

## 📂 소프트웨어 구조 (Software Structure)

코드는 기능별로 여러 파일로 나뉘어 있습니다. (`.ino` 파일들)

| 파일명 | 역할 & 설명 |
| :--- | :--- |
| **`GameFSM.cpp`** | **핵심 두뇌**. 게임의 상태(준비, 활성, 완료 등)를 관리합니다. |
| **`encoder.ino`** | 핸들을 얼마나 돌렸는지 감지합니다. |
| **`neopixel.ino`** | LED 불빛을 제어합니다. (게이지, 깜빡임 등) |
| **`rfid.ino`** | 카드를 댔을 때 누구의 카드인지 인식합니다. |
| **`Wifi.ino`** | 중앙 서버와 통신하여 게임 시작/종료 신호를 주고받습니다. |
| **`Nextion.ino`** | LCD 화면에 그림을 띄우거나 터치를 입력받습니다. |
| **`timer.ino`** | 시간 제한이나 주기적인 작업(LED 깜빡임)을 담당합니다. |

---

## 🚀 사용 방법 (How to Use)

### 1. 설치 및 업로드
1.  **Arduino IDE**를 설치합니다.
2.  이 프로젝트 폴더를 엽니다. (`updated_generator.ino` 실행)
3.  **라이브러리 매니저**에서 다음 라이브러리를 설치합니다:
    *   `Adafruit NeoPixel`
    *   `Adafruit PN532`
    *   `ArduinoJson`
    *   `SimpleTimer` (또는 유사한 타이머 라이브러리)
4.  보드를 **ESP32 Dev Module**로 선택하고 업로드합니다.

### 2. 시리얼 명령어 (Serial Commands)
시리얼 모니터(115200bps)를 열고 다음 명령어를 입력하여 장치를 테스트할 수 있습니다.

| 명령어 | 동작 | 설명 |
| :--- | :--- | :--- |
| **`S`** | **Setting** | 초기 설정 모드 (흰색 LED) |
| **`R`** | **Ready** | 게임 준비 모드 (빨간색 LED, 태그 대기) |
| **`A`** | **Activate** | 게임 활성화 (노란색 LED, 로그인 대기) |
| **`watchdog`** | **Reset** | 장치를 강제로 재부팅합니다. |
| **`check`** | **Status** | 현재 상태를 확인합니다. |
| **`mbm`** | **Battery Max** | 배터리가 가득 찬 상태로 강제 변경 |
| **`msf`** | **Starter Finish** | 스타터 가동 완료 상태로 강제 변경 |
| **`mr`** | **Repaired** | 수리 완료 상태로 강제 변경 |
| **`mra`** | **Repaired All** | 전체 수리 완료(탈출) 상태로 강제 변경 |

---

## ⚙️ 동작 흐름 (Game Flow)

1.  **대기 (`Setting`/`Ready`)**: 플레이어가 오기를 기다립니다.
2.  **로그인 (`Activate`)**: 플레이어가 RFID 카드를 태그합니다.
3.  **발전 (`Starter`)**: 핸들을 마구 돌려 게이지를 채웁니다.
4.  **완료 (`Finish`)**: 게이지가 다 차면 발전기가 가동되고 다음 단계로 넘어갑니다.
